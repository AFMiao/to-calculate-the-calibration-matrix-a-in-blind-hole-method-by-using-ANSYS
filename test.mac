! 工作目录
! D:/LEARNING/Courses/IV/FECD/manual/code
FINISH $ /CLEAR
/FILNAME,3-02
/TITLE,3-02
!==========
! 长度单位统一为mm
! 注: 用等式给参数赋值的时候
! 运算符号前后千万不要加空格
D = 5.13 $ D0 = 0.5*D
DEPTH = 1.2*D $ L = 10*D
ENUM_L=10

R1 = 1.77 $ R2 = 3.36
GL = 1.59 $ GW = 1.59

dh = 0.05 $ n = 20
h = dh*n $ DA = DH*L
SIGMA_X = 100

E = 2.1E5 $ v = 0.3
!==========
/PREP7
ET,1,SOLID186
! KEYOPT,1,2,3

ET,2,MESH200,11

MP,EX,1,E
MP,PRXY,1,v
MP,EX,2,E
MP,PRXY,2,v
!==========
! 建立工件下表面
*DIM,PQRS_1,ARRAY,4
*DO,I,1,4,1
  PQRS_1(I)=I
*ENDDO
K,1,L,L,0  ! P1
K,2,0,L,0  ! Q1
K,3,0,0,0  ! R1
K,4,L,0,0  ! S1
K,5,L/2,L/2,0  ! 中心

*DIM,L_PQRS_1,ARRAY,4
L,1,2 $ L_PQRS_1(1)=_RETURN  ! P1Q1
L,2,3 $ L_PQRS_1(2)=_RETURN  ! Q1R1
L,3,4 $ L_PQRS_1(3)=_RETURN  ! R1S1
L,4,1 $ L_PQRS_1(4)=_RETURN  ! S1P1

*DIM,PQRS_0,ARRAY,4
*DO,I,1,4,1
  PQRS_0(I)=40+I
*ENDDO
K,41,L/2+2*D0,L/2+2*D0,0  ! P0
K,42,L/2-2*D0,L/2+2*D0,0  ! Q0
K,43,L/2-2*D0,L/2-2*D0,0  ! R0
K,44,L/2+2*D0,L/2-2*D0,0  ! S0

*DIM,L_PQRS_0,ARRAY,4
L,41,42 $ L_PQRS_0(1)=_RETURN  ! P0Q0
L,42,43 $ L_PQRS_0(2)=_RETURN  ! Q0R0
L,43,44 $ L_PQRS_0(3)=_RETURN  ! R0S0
L,44,41 $ L_PQRS_0(4)=_RETURN  ! S0P0

*DIM,DIAGONAL,ARRAY,4
L,1,41 $ DIAGONAL(1)=_RETURN  ! P0P1
L,2,42 $ DIAGONAL(2)=_RETURN  ! Q0Q1
L,3,43 $ DIAGONAL(3)=_RETURN  ! R0R1
L,4,44 $ DIAGONAL(4)=_RETURN  ! S0S1

 ! 建立过渡圆
CIRCLE,5,(D0/2+R1)/2
ARC_AISSIT1=_RETURN
*DIM,MIDPOINT,ARRAY,4  ! 创建一个储存中点序号的数组
*DO,I,1,4,1
  MIDPOINT(I)=60+I
*ENDDO
*DO,I,0,3,1  ! 创建中点、赋值并分割
  KL,ARC_AISSIT1+I,0.5,MIDPOINT(I+1)
  L,MIDPOINT(I+1),PQRS_0(I+1)
  L_CACHE=_RETURN
  LSBL,ARC_AISSIT1+I,L_CACHE
*ENDDO
LCOMB,17,19,0  ! 不要问我怎么知道是这个数
LCOMB,15,18,0  ! 我就是知道
LCOMB,14,20,0
LCOMB,21,22,0

AL,P0Q0,Q0R0,R0S0,S0P0
A0=_RETURN

AL,P1Q1,Q0Q1,P0Q0,P0P1
AL,Q1R1,R0R1,Q0R0,Q0Q1
AL,R0S0,R0R1,R1S1,S0S1
AL,P0P1,S0P0,S0S1,S1P1

! 建立圆面
CYL4,L/2,L/2,D0/2

! 减去不必要的部分
ASEL,A,LOC,X,L/2-D0/2-0.1,L/2+D0/2+0.1
ASBA,A0,ALL,,DELETE,KEEP
! 获取新生成的面的序号
*GET,A0,AREA,0,NUM,MAX

! 通过循环创建应变花
K,11,L/2+R1,L/2+GW/2
K,12,L/2+R1,L/2-GW/2
K,13,L/2+R2,L/2-GW/2
K,14,L/2+R2,L/2+GW/2

! K,21,L/2-0.5*D/1.414         ,L/2+0.5*D/1.414-GW/1.414
! K,22,L/2-0.5*D/1.414+GL/1.414,L/2+0.5*D/1.414
! K,23,L/2-0.5*D/1.414         ,L/2+0.5*D/1.414+GW/1.414
! K,24,L/2-0.5*D/1.414-GL/1.414,L/2+0.5*D/1.414

K,31,L/2+GW/2,L/2-R1
K,32,L/2-GW/2,L/2-R1
K,33,L/2-GW/2,L/2-R2
K,34,L/2+GW/2,L/2-R2

*DIM,NUM_GAUGE,ARRAY,3,1
*DO,I,1,3,2
  L,10*I+1,10*I+2 $ L,10*I+2,10*I+3
  L,10*I+3,10*I+4 $ L,10*I+4,10*I+1
  L_CACHE=_RETURN

  AL,L_CACHE-3,L_CACHE-2,L_CACHE-1,L_CACHE
  A_CACHE=_RETURN

  ! 减去不必要的部分
  ASBA,A0,A_CACHE,,DELETE,KEEP
  ! 获取新生成面的序号
  *GET,A0,AREA,0,NUM,MAX
*ENDDO


LSEL,ALL
LSEL,R,LOC,X,L/2-R2,L/2+R2
LSEL,R,LOC,Y,L/2-R2,L/2+R2
LESIZE,ALL,,,5

LSEL,INVE
LESIZE,ALL,,,ENUM_L


ASEL,ALL
ASEL,U,AREA,,A0
MSHKEY,1
AMESH,ALL

ASEL,INVE
MSHKEY,0
AMESH,ALL

ESEL,ALL
EPLOT